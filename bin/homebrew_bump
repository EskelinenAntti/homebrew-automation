#!/bin/bash

set -e

if [[ -z "$1" ]]; then
    echo "Usage $0 [tap]"
    exit 1
fi
TAP="$1"

brew update
brew livecheck --tap="$TAP" --json |
    jq -r '.[] | select(.version.outdated == true) | "\(.formula) \(.version.latest)"' |
    while read -r formula version; do
        brew bump-formula-pr \
            --version "$version" \
            "$formula"
    done

